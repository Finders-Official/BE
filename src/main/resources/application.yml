spring:
  application:
    name: finders-api

  # 프로필 설정 (기본값: local)
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}

  # Virtual Threads (Java 21+)
  threads:
    virtual:
      enabled: true

  # ========================================
  # Database (MySQL)
  # ========================================
  # 환경변수 SPRING_DATASOURCE_* 로 자동 오버라이드됨
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/finders?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: finders
    password: finders123
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000

  # ========================================
  # JPA 공통 설정
  # ========================================
  jpa:
    database: mysql
    database-platform: org.hibernate.dialect.MySQLDialect
    open-in-view: false
    properties:
      hibernate:
        format_sql: true
        default_batch_fetch_size: 100

  # ========================================
  # Jackson 설정 (ISO 8601 표준)
  # ========================================
  jackson:
    default-property-inclusion: non_null
    time-zone: Asia/Seoul
    serialization:
      write-dates-as-timestamps: false

# ========================================
# Server 설정
# ========================================
server:
  port: 8080
  servlet:
    context-path: /api

# ========================================
# JWT 설정
# ========================================
jwt:
  secret: ${JWT_SECRET:local-dev-secret-key-must-be-at-least-256-bits-long-for-hs256}
  access-token-expiry: ${JWT_ACCESS_EXPIRY:3600000}      # 1시간
  refresh-token-expiry: ${JWT_REFRESH_EXPIRY:604800000}  # 7일
  signup-token-expiry: ${JWT_SIGNUP_EXPIRY:1200000}       # 20분

# ========================================
# OAuth2 설정
# ========================================
oauth2:
  kakao:
    client-id: ${KAKAO_CLIENT_ID:}
    client-secret: ${KAKAO_CLIENT_SECRET:}
    redirect-uri: ${KAKAO_REDIRECT_URI:http://localhost:5173/auth/kakao/callback}
  apple:
    client-id: ${APPLE_CLIENT_ID:}
    team-id: ${APPLE_TEAM_ID:}
    key-id: ${APPLE_KEY_ID:}
    redirect-uri: ${APPLE_REDIRECT_URI:http://localhost:8080/api/auth/apple/callback}

# ========================================
# Google Cloud 설정
# ========================================
google:
  cloud:
    project-id: ${GOOGLE_CLOUD_PROJECT:}
    credentials:
      location: ${GOOGLE_APPLICATION_CREDENTIALS:}
    storage:
      public-bucket: ${GCS_PUBLIC_BUCKET:finders-public}
      private-bucket: ${GCS_PRIVATE_BUCKET:finders-private}
      signed-url-expiry-minutes: ${GCS_SIGNED_URL_EXPIRY:60}
      service-account-email: ${GCS_SERVICE_ACCOUNT_EMAIL:}

# ========================================
# Actuator 설정
# ========================================
management:
  endpoints:
    web:
      exposure:
        include: health, info
  endpoint:
    health:
      show-details: when_authorized

# ========================================
# Swagger 설정
# ========================================
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: alpha
    tags-sorter: alpha
  api-docs:
    path: /v3/api-docs
  default-consumes-media-type: application/json
  default-produces-media-type: application/json
  use-fqn: true   # DTO 클래스 이름 충돌을 방지하기 위해 FQN(Fully Qualified Name) 사용

# ========================================
# PortOne V2 결제 설정
# ========================================
portone:
  api-secret: ${PORTONE_API_SECRET:}
  webhook-secret: ${PORTONE_WEBHOOK_SECRET:}
  store-id: ${PORTONE_STORE_ID:}

# ========================================
# Replicate AI 설정
# ========================================
replicate:
  api-key: ${REPLICATE_API_KEY:}
  base-url: https://api.replicate.com/v1
  model-version: ${REPLICATE_MODEL_VERSION:}
  webhook-base-url: ${WEBHOOK_BASE_URL:http://localhost:8080/api}
  webhook-secret: ${REPLICATE_WEBHOOK_SECRET:}
  timeout-seconds: 120
  max-retries: 60

# ========================================
# Sentry 설정 (에러 모니터링)
# ========================================
sentry:
  dsn: ${SENTRY_DSN:}
  environment: ${SPRING_PROFILES_ACTIVE:local}
  release: ${info.build.name:finders-api}@${info.build.version:unknown}
  traces-sample-rate: 1.0
  send-default-pii: false
  in-app-includes: com.finders  # 스택트레이스에서 우리 코드 하이라이트

# ========================================
# Logging 설정
# ========================================
logging:
  level:
    root: INFO
    com.finders: DEBUG

# ========================================
# CORS 설정
# ========================================
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:5173}

dev:
  secret-key: ${LOGIN_SECRET_KEY:local-dummy-key}